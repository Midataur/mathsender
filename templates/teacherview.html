{% extends "base.html" %}
{% block title%}Teacher{%endblock%}
{% block roomCode %}Room Code: {{code}}{%endblock%}
{% block head %}

<script type="text/javascript" charset="utf-8">
	//puts you in a room
    var socket = io();
    socket.on('connect', function() {
        socket.emit('room_connect','{{code}}');
    });
</script>

<script>
	function send_question() {
		var question = questionMathField.latex();
		var code = '{{code}}';
		var password = '{{password}}'
		socket.emit('new_question',question,code,password);
		alert('Question sent!')
		return false;
	}
</script>

<script>
    function gen_question_el(question,qid) {
		question_el = document.createElement("a");
		div = document.createElement('div')
		question_el.href = '{{code}}/questions/'+qid+'?password={{password}}';
		div.innerText = question;
		$(div).addClass("button -fill -math")
		question_el.appendChild(div)
		container = document.createElement('div')
		container.appendChild(question_el)
        return container;
    }
</script>

<script type="text/javascript" charset="utf-8">
    socket.on('new_question_client', function( qdata ) {
		question = '\\('+qdata[0]+'\\)';
		qid = qdata[1];

        question_el = gen_question_el(question,qid);
        console.log(question_el);
        
		questions = document.getElementById('questions');

		questions.insertBefore(question_el, questions.firstChild);
		renderMathInElement(question_el);
    });
</script>

{% endblock %}
{% block content %}
		<h2 class="text-heading">Submit new question</h2>
		<label class="field twopart-field">
			<div class="twopart-field__left">Question:</div>
			<span id="question-input" class="field__input twopart-field__right -math"></span>
		</label>
			
		
		<!-- MathQuill -->
		<script>
			var questionSpan = document.getElementById('question-input');
			var questionMathField = MQ.MathField(questionSpan, {
			  handlers: {
				enter: function() {
					send_question(); //submit the question
				}
			  }
			});
		</script>

		
		<p class="wysiwyg">All \(\LaTeX\) is supported. For a cheatsheet click <a href="https://www.math.brown.edu/~jhs/ReferenceCards/TeXRefCard.v1.5.pdf" target="_blank">here</a></p>
		<br>
		<h3 class="text-heading -sub">Existing questions:</h3>
		<div id="questions" class="questions">
			{% for question in questions %}
				<div>
					<a href="{{code}}/questions/{{question['id']}}?password={{password}}"><div class="button -fill -math">\({{question['text']}}\)</div></a>
				</div>
			
			{% endfor %}
		</div>

{%endblock%}
