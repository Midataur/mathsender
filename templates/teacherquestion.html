{% extends "base.html" %}
{% block title%}Teacher{%endblock%}
{% block roomCode %}Room Code: {{code}}{%endblock%}
{% block head %}

<script>
	// Puts you in a room
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function() {
        socket.emit('room_connect','{{code}}');
        socket.emit('request_answers','{{code}}','{{question["id"]}}');
    });
</script>

<script>
    // Render the existing answers
    loaded = false;
	socket.on('answers_list', function( answers_input ) {
        answers = answers_input
		if (!loaded) {
            console.log(answers)
            answers_div = document.getElementById('answers');   // answers_div is an empty div where all the answers will go
			for (i = 0; i < answers.length; i++) {
                answer = answers[i]
                // Generate the div for each answer and add it
				answer_div = gen_answer_div(answer, answer['correct']);
                answers_div.insertBefore(answer_div,answers_div.firstChild)
                renderMathInElement(answers_div)
            }
			loaded = true;
		}
    });
</script>

<script>
    // Handle new answers
    socket.on('new_answer_teacher', function( data ) {
        //Check that the question is for the right room
        //make a room for each question (?)
        if (data['qid'] == '{{question["id"]}}'){
            console.log('new answer')
            answer = data['answer']
            answer_div = gen_answer_div(answer, answer['correct']);
            answers_div.insertBefore(answer_div,answers_div.firstChild)
            renderMathInElement(answers_div)
        }
    });
</script>

<script>
    // Define function to generate the div for an answer

    function gen_answer_div(answer,correct) {
        // Make a container
        container = document.createElement('div')
        container.id = 'answer-' + answer['submitted_by'];
        
        if (correct){
            container.className = 'correct answer'
        }
        else if (correct == false){
            container.className = 'incorrect answer'
        }
        else {
            container.className = 'answer'
        }

        // Paragraph with name & answer info
        p = document.createElement("p");
        t1 = document.createTextNode('Submitted by: '+answer['submitted_by']);
        t2 = document.createTextNode('Answer given: '+answer['answer']);
        p.appendChild(t1);
        p.appendChild(document.createElement('br'));
        p.appendChild(t2);
        p.appendChild(document.createElement('br'));
        container.append(p);

        // Tick and cross icons
        icons = document.createElement('div');
        icons.className = 'icons';

        tick = document.createElement("img");
        tick.className = 'tick';
        tick.src = '/static/tick.svg';
        tick.onclick = function() {socket.emit('autocorrect', answer, true,'{{code}}','{{question["id"]}}')};

        cross = document.createElement("img");
        cross.className = 'cross';
        cross.src = '/static/cross.svg';
        cross.onclick = function() {socket.emit('autocorrect', answer, false,'{{code}}','{{question["id"]}}')};

        icons.appendChild(tick);
        icons.appendChild(cross);
        container.appendChild(icons)

        return container;
    }
</script>

<script>
    socket.on('mark_correct', function ( data ) {
        // Same as accepting new answers
        // Check that the correction is for the right room
        // make a room for each question (?)

        if (data['qid'] == '{{question["id"]}}'){
            answer = data['answer']
            console.log('Autograded ' + answer['submitted_by'] + "'s answer")
            container = document.getElementById('answer-' + answer['submitted_by'])
            container.className = 'correct answer';
        }
    });

    socket.on('mark_incorrect', function ( data ) {
        // Same as accepting new answers
        // Check that the correction is for the right room
        // make a room for each question (?)

        if (data['qid'] == '{{question["id"]}}'){
            answer = data['answer']
            console.log('Autograded ' + answer['submitted_by'] + "'s answer")
            container = document.getElementById('answer-' + answer['submitted_by'])
            container.className = 'incorrect answer';
        }
    });
</script>


		
{% endblock %}
{% block content %}

        <a href="/teacher/room/{{code}}?password={{password}}">Back</a>
        <h2 class="text-heading">\({{question['text']}}\)</h2>

        <h3 class="text-heading -sub">Answers:</h3>

        <!-- Filled by JS -->
        <div id="answers"></div>
{%endblock%}